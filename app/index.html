<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html id="futuron" class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>FUTURON</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
        <!-- build:css(.tmp) styles/main.css -->
        <link rel="stylesheet" href="styles/main.css">
		<link rel="stylesheet" href="styles/jquery.terminal.css">
		<link rel="stylesheet" href="styles/tr2n.css">
        <!-- endbuild -->
    </head>
    <body>
        <!--[if lt IE 10]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
        
        <div class="top">
        	Futuron
        </div>
		<div class="middle clearfix">
			<div class="grid"></div>
			<div class="legend"></div>
		</div>
		<div class="bottom">
			<div class="terminal"></div>
		</div>

        <!-- build:js scripts/vendor.js -->
        <!-- bower:js -->
        <script src="bower_components/jquery/jquery.js"></script>
        <script src="bower_components/underscore/underscore.js"></script>
        <!-- endbower -->
        <!-- endbuild -->
		
		<script src="bower_components/jquery.terminal/js/jquery.terminal-0.7.5.js"></script>

        <!-- build:js scripts/main.js -->
        <script src="scripts/main.js"></script>
        <!-- endbuild -->
	</body>
	
	<script id="worker-template" type="text/js-worker-template">
		;(function() {
			var size = 0
		
			var loadLibraries = function(url) {
				importScripts(url + 'bower_components/underscore/underscore.js')
			}
			
			var initialize = function(spec) {
				size = spec.size
				loadLibraries(spec.url)
			}
			
			var makeLook = function(arena) {
				return function(pos) {
					var x = pos[0], y = pos[1]
					return (x < 0) || (x >= size) || (y < 0) || (y >= size) ||
						_.some(arena, function(wall) {
							return wall[0] === x && wall[1] === y
						})
				}
			}
			
			var turnLeft = function(dir) {
				return [dir[1], -dir[0]]
			}
			
			var turnRight = function(dir) {
				return [-dir[1], dir[0]]
			}
			
			// INJECTED BOT CODE
			<%= body %>
	
			onmessage = function(m) {
				switch (m.data.cmd) {
					case 'name':
						initialize(m.data.args)
						postMessage({cmd: 'name', args: name})
						break
					case 'move':
						postMessage({ cmd: 'move', args:
							strategy(makeLook(m.data.args.arena), m.data.args.state)
						})
						break
					default:
				}
			}
		})()
	</script>
</html>
